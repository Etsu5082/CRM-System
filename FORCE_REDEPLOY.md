# Render å¼·åˆ¶å†ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

## ã€ŒSuspend Serviceã€ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ

åˆ¥ã®æ–¹æ³•ã§å¼·åˆ¶çš„ã«æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã•ã›ã¾ã™ã€‚

## ğŸ“‹ æ‰‹é †

### æ–¹æ³•1: ç’°å¢ƒå¤‰æ•°ã‚’å¤‰æ›´ã—ã¦å†ãƒ‡ãƒ—ãƒ­ã‚¤

1. Renderãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ **crm-api-gateway** â†’ **Environment**
2. æ–°ã—ã„ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ï¼š
   ```
   FORCE_REBUILD=true
   ```
3. ã€ŒSave Changesã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. è‡ªå‹•çš„ã«å†ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé–‹å§‹ã•ã‚Œã¾ã™
5. ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã‚’å¾…ã¤

### æ–¹æ³•2: Dockerfileã«ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 

ãƒ€ãƒŸãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ï¼ˆã™ã§ã«å®Ÿè¡Œæ¸ˆã¿ï¼‰

### æ–¹æ³•3: Shell ã‚¿ãƒ–ã§å†èµ·å‹•

1. Renderãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ **crm-api-gateway**
2. ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® **ã€ŒShellã€** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼š
   ```bash
   cat /app/dist/server.js | grep "req.path.replace"
   ```
4. å‡ºåŠ›ã‚’ç¢ºèªï¼š
   - `const path = req.path.replace('/api', '');` ãªã‚‰æ­£ã—ã„
   - `const path = req.path.replace(pathPrefix, '');` ãªã‚‰å¤ã„

### æ–¹æ³•4: ã‚µãƒ¼ãƒ“ã‚¹åã‚’å¤‰æ›´

**ã“ã‚ŒãŒæœ€ã‚‚ç¢ºå®Ÿãªæ–¹æ³•ã§ã™**

1. Settings â†’ Service Name ã‚’å¤‰æ›´
   - ç¾åœ¨: `crm-api-gateway`
   - æ–°ã—ã„: `crm-api-gateway-v2`
2. ã€ŒSave Changesã€
3. å®Œå…¨ã«æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¾ã™

## ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±

Renderã®ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨ã€æ­£ã—ããƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ï¼š
```
#12 [builder 7/7] RUN rm -rf dist && npm run build
#12 0.342 > api-gateway@1.0.0 build
#12 0.342 > tsc
#12 DONE 3.7s
```

ã—ã‹ã—ã€å®Ÿè¡Œæ™‚ã«ã¯å¤ã„ã‚³ãƒ¼ãƒ‰ãŒå‹•ã„ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯RenderãŒDockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

## ğŸ’¡ æ¨å¥¨ã•ã‚Œã‚‹å¯¾å¿œ

**æ–¹æ³•1ï¼ˆç’°å¢ƒå¤‰æ•°è¿½åŠ ï¼‰**ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€Renderã¯æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹•ã—ã¾ã™ã€‚

ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ å¾Œã€ãƒ­ã‚°ã§ä»¥ä¸‹ã‚’ç¢ºèªï¼š

```
[Proxy] POST /api/customers -> https://crm-customer-service.onrender.com/customers
```

`/customers` ã«ãªã£ã¦ã„ã‚Œã°OKï¼
