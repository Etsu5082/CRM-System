# CRMã‚·ã‚¹ãƒ†ãƒ  ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

## ğŸ“‹ ç›®æ¬¡
1. [ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
2. [ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åˆ†å‰²æˆ¦ç•¥](#ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åˆ†å‰²æˆ¦ç•¥)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œå®šç¾©](#ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œå®šç¾©)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
6. [ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡](#ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡)
7. [ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰](#ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)

---

## ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Internet / Users                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Ingress Controller                         â”‚
â”‚                   (NGINX / Traefik)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         â”‚
         â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Shell  â”‚      â”‚   API Gateway    â”‚
â”‚  (Next.js Host)  â”‚      â”‚   (Node.js)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â”‚ Module Federation     â”‚ REST/gRPC
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Micro Frontends (Remotes)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Customer â”‚ â”‚  Sales   â”‚ â”‚Opportunityâ”‚ â”‚Analytics â”‚      â”‚
â”‚  â”‚   MFE    â”‚ â”‚   MFE    â”‚ â”‚   MFE    â”‚ â”‚   MFE    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ API Calls
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Backend Services                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Auth   â”‚ â”‚ Customer â”‚ â”‚  Sales   â”‚ â”‚Opportunityâ”‚      â”‚
â”‚  â”‚ Service  â”‚ â”‚ Service  â”‚ â”‚ Activity â”‚ â”‚ Service  â”‚      â”‚
â”‚  â”‚          â”‚ â”‚          â”‚ â”‚ Service  â”‚ â”‚          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚            â”‚            â”‚            â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚            Analytics Service                     â”‚       â”‚
â”‚  â”‚         (Event Consumer & Aggregator)            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                              â”‚
            â”‚ Kafka Event Bus              â”‚ Database Access
            â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Apache Kafka       â”‚     â”‚   Database per Service          â”‚
â”‚  (Event Streaming)   â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                      â”‚     â”‚  â”‚ Auth   â”‚ â”‚Customerâ”‚         â”‚
â”‚  Topics:             â”‚     â”‚  â”‚   DB   â”‚ â”‚   DB   â”‚         â”‚
â”‚  - user.events       â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  - customer.events   â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  - sales.events      â”‚     â”‚  â”‚ Sales  â”‚ â”‚Opport- â”‚         â”‚
â”‚  - approval.events   â”‚     â”‚  â”‚   DB   â”‚ â”‚ nity DBâ”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                             â”‚  â”‚Analytics                     â”‚
                             â”‚  â”‚   DB   â”‚                     â”‚
                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åˆ†å‰²æˆ¦ç•¥

### 1. **Auth Service** (èªè¨¼ãƒ»èªå¯ã‚µãƒ¼ãƒ“ã‚¹)

**è²¬ä»»ç¯„å›²:**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ (Login/Logout)
- JWT ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œãƒ»æ¤œè¨¼
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† (CRUD)
- ãƒ­ãƒ¼ãƒ«ãƒ»æ¨©é™ç®¡ç† (RBAC)
- ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
- User
- AuditLog

**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
POST   /auth/login
POST   /auth/logout
POST   /auth/refresh
GET    /auth/me
POST   /auth/users
GET    /auth/users
GET    /auth/users/:id
PUT    /auth/users/:id
DELETE /auth/users/:id
GET    /auth/audit-logs
```

**ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ:**
- `user.created`
- `user.updated`
- `user.deleted`
- `user.login`
- `user.logout`

---

### 2. **Customer Service** (é¡§å®¢ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹)

**è²¬ä»»ç¯„å›²:**
- é¡§å®¢æƒ…å ±ç®¡ç† (CRUD)
- æŠ•è³‡ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- é¡§å®¢æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- æ‹…å½“å–¶æ¥­ã‚¢ã‚µã‚¤ãƒ³

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
- Customer

**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
POST   /customers
GET    /customers
GET    /customers/:id
PUT    /customers/:id
DELETE /customers/:id (Soft Delete)
GET    /customers/search
GET    /customers/by-sales/:salesId
```

**ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ:**
- `customer.created`
- `customer.updated`
- `customer.deleted`
- `customer.assigned`

**ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­:**
- `user.deleted` â†’ æ‹…å½“å–¶æ¥­ã®å†ã‚¢ã‚µã‚¤ãƒ³

---

### 3. **Sales Activity Service** (å–¶æ¥­æ´»å‹•ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹)

**è²¬ä»»ç¯„å›²:**
- å•†è«‡è¨˜éŒ²ç®¡ç†
- ã‚¿ã‚¹ã‚¯ç®¡ç†
- æ´»å‹•å±¥æ­´è¿½è·¡
- æœŸé™ç®¡ç†ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
- Meeting
- Task

**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
POST   /meetings
GET    /meetings
GET    /meetings/:id
PUT    /meetings/:id
DELETE /meetings/:id
GET    /meetings/customer/:customerId

POST   /tasks
GET    /tasks
GET    /tasks/:id
PUT    /tasks/:id
DELETE /tasks/:id
PATCH  /tasks/:id/status
GET    /tasks/overdue
```

**ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ:**
- `meeting.created`
- `meeting.updated`
- `task.created`
- `task.updated`
- `task.completed`
- `task.due_soon`

**ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­:**
- `customer.deleted` â†’ é–¢é€£ã‚¿ã‚¹ã‚¯ãƒ»å•†è«‡ã®å‰Šé™¤

---

### 4. **Opportunity Service** (å•†è«‡ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹)

**è²¬ä»»ç¯„å›²:**
- æ‰¿èªç”³è«‹ç®¡ç†
- æ‰¿èªãƒ•ãƒ­ãƒ¼åˆ¶å¾¡
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¿½è·¡
- æ‰¿èªå±¥æ­´ç®¡ç†

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
- ApprovalRequest

**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
POST   /approvals
GET    /approvals
GET    /approvals/:id
PUT    /approvals/:id
PATCH  /approvals/:id/approve
PATCH  /approvals/:id/reject
GET    /approvals/pending
GET    /approvals/requester/:userId
GET    /approvals/approver/:userId
```

**ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ:**
- `approval.requested`
- `approval.approved`
- `approval.rejected`
- `approval.recalled`

**ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­:**
- `customer.deleted` â†’ é–¢é€£æ‰¿èªç”³è«‹ã®å‰Šé™¤
- `user.deleted` â†’ æ‰¿èªè€…ã®å†ã‚¢ã‚µã‚¤ãƒ³

---

### 5. **Analytics Service** (åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹)

**è²¬ä»»ç¯„å›²:**
- ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- KPIé›†è¨ˆ
- é€šçŸ¥ç®¡ç†
- ã‚¤ãƒ™ãƒ³ãƒˆé›†ç´„ãƒ»åˆ†æ

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
- Notification
- AggregatedMetrics (Read Model)

**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
GET    /reports/sales-summary
GET    /reports/customer-statistics
GET    /reports/approval-statistics
GET    /reports/task-completion

GET    /notifications
GET    /notifications/unread
PATCH  /notifications/:id/read
PATCH  /notifications/read-all
DELETE /notifications/:id
```

**ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­:**
- ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­
- ã‚¤ãƒ™ãƒ³ãƒˆé›†ç´„ãƒ»åˆ†æ
- é€šçŸ¥ç”Ÿæˆ

**ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ:**
- `notification.created`

---

### 6. **API Gateway**

**è²¬ä»»ç¯„å›²:**
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- èªè¨¼å§”è­² (Auth Service ã¸)
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›
- CORSå‡¦ç†

**æŠ€è¡“:**
- Node.js + Express
- ã¾ãŸã¯ Kong / Traefik

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### Backend Services

| ã‚µãƒ¼ãƒ“ã‚¹ | è¨€èª/FW | ç†ç”± |
|---------|---------|------|
| **Auth Service** | Node.js + Express + TypeScript | JWTå‡¦ç†ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æ´»ç”¨ |
| **Customer Service** | Node.js + Express + TypeScript | æ—¢å­˜Prismaã‚¹ã‚­ãƒ¼ãƒæ´»ç”¨ã€é«˜é€Ÿé–‹ç™º |
| **Sales Activity Service** | Node.js + Express + TypeScript | æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æ´»ç”¨ |
| **Opportunity Service** | Node.js + Express + TypeScript | ä¸€è²«æ€§ç¶­æŒ |
| **Analytics Service** | Node.js + Express + TypeScript | ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰æ´»ç”¨ |
| **API Gateway** | Node.js + Express ã¾ãŸã¯ Kong | æŸ”è»Ÿãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€èªè¨¼é€£æº |

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

| ã‚µãƒ¼ãƒ“ã‚¹ | DB | ç†ç”± |
|---------|---------|------|
| **Auth Service** | PostgreSQL | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ |
| **Customer Service** | PostgreSQL | è¤‡é›‘ãªã‚¯ã‚¨ãƒªã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ |
| **Sales Activity Service** | PostgreSQL | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ |
| **Opportunity Service** | PostgreSQL | ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã€æ•´åˆæ€§ |
| **Analytics Service** | PostgreSQL + Redis | é›†ç´„ãƒ‡ãƒ¼ã‚¿ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°

- **Apache Kafka**: ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã€é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
- **ä»£æ›¿æ¡ˆ**: RabbitMQ (ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã®å ´åˆ)

### Frontend

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| **Next.js 14** | Host Shell (App Router) |
| **Webpack Module Federation** | ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ |
| **React 18** | UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| **TanStack Query** | ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚° |
| **Zustand** | çŠ¶æ…‹ç®¡ç† |

### Infrastructure

- **Kubernetes**: ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **Docker**: ã‚³ãƒ³ãƒ†ãƒŠåŒ–
- **Helm**: K8s ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°
- **Prometheus + Grafana**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–
- **ELK Stack**: ãƒ­ã‚°é›†ç´„
- **Jaeger**: åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°

---

## ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œå®šç¾©

### ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ (DDD) ã«åŸºã¥ãå¢ƒç•Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Bounded Contexts                          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Identity &     â”‚  â”‚   Customer     â”‚                    â”‚
â”‚  â”‚ Access Context â”‚  â”‚    Context     â”‚                    â”‚
â”‚  â”‚                â”‚  â”‚                â”‚                    â”‚
â”‚  â”‚ - User         â”‚  â”‚ - Customer     â”‚                    â”‚
â”‚  â”‚ - Role         â”‚  â”‚ - Profile      â”‚                    â”‚
â”‚  â”‚ - Permission   â”‚  â”‚ - Assignment   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Sales Activity â”‚  â”‚  Opportunity   â”‚                    â”‚
â”‚  â”‚    Context     â”‚  â”‚    Context     â”‚                    â”‚
â”‚  â”‚                â”‚  â”‚                â”‚                    â”‚
â”‚  â”‚ - Meeting      â”‚  â”‚ - Approval     â”‚                    â”‚
â”‚  â”‚ - Task         â”‚  â”‚ - Workflow     â”‚                    â”‚
â”‚  â”‚ - Activity     â”‚  â”‚ - Stage        â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚      Analytics Context             â”‚                    â”‚
â”‚  â”‚                                    â”‚                    â”‚
â”‚  â”‚ - Report                           â”‚                    â”‚
â”‚  â”‚ - Notification                     â”‚                    â”‚
â”‚  â”‚ - Metrics                          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚µãƒ¼ãƒ“ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚

```
Auth Service (Core)
    â†“ (ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒèªè¨¼ã«ä¾å­˜)
    â”œâ”€â†’ Customer Service
    â”œâ”€â†’ Sales Activity Service
    â”œâ”€â†’ Opportunity Service
    â””â”€â†’ Analytics Service (ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ã®ã¿)
```

**åŸå‰‡:**
- **åŒæœŸé€šä¿¡**: REST API (ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã€ãƒ‡ãƒ¼ã‚¿å–å¾—)
- **éåŒæœŸé€šä¿¡**: Kafka Events (ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã€é€šçŸ¥)
- **å‚ç…§ãƒ‡ãƒ¼ã‚¿**: å„ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…è¦æœ€å°é™ã®ã‚³ãƒ”ãƒ¼ã‚’ä¿æŒ

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### Database per Service ãƒ‘ã‚¿ãƒ¼ãƒ³

å„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒç‹¬ç«‹ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æŒã¤:

```
auth_db:
  - users
  - audit_logs

customer_db:
  - customers

sales_activity_db:
  - meetings
  - tasks

opportunity_db:
  - approval_requests

analytics_db:
  - notifications
  - aggregated_metrics (Read Model)
```

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§æˆ¦ç•¥

1. **Saga ãƒ‘ã‚¿ãƒ¼ãƒ³**: åˆ†æ•£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
   - ä¾‹: é¡§å®¢å‰Šé™¤æ™‚ã®é–¢é€£ãƒ‡ãƒ¼ã‚¿å‰Šé™¤

2. **Eventual Consistency**: æœ€çµ‚çš„æ•´åˆæ€§
   - ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã§éåŒæœŸåŒæœŸ

3. **CQRS**: ã‚³ãƒãƒ³ãƒ‰ã¨ã‚¯ã‚¨ãƒªã®åˆ†é›¢
   - Analytics Serviceã§èª­ã¿å–ã‚Šå°‚ç”¨ãƒ¢ãƒ‡ãƒ«

---

## ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡

### åŒæœŸé€šä¿¡ (REST API)

**èªè¨¼ãƒ•ãƒ­ãƒ¼:**
```
Client â†’ API Gateway â†’ Auth Service
                     â†“ (JWT Token)
                   Client
```

**ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒ­ãƒ¼:**
```
Client â†’ API Gateway â†’ Customer Service
                     â†’ Sales Activity Service
                     â†’ Opportunity Service
```

### éåŒæœŸé€šä¿¡ (Kafka Events)

**ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ•ãƒ­ãƒ¼:**
```
Customer Service â†’ Kafka (customer.created)
                     â†“
                   â”Œâ”€â”´â”€â”
                   â”‚   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                                  â†“
Sales Activity Service        Analytics Service
(é¡§å®¢æƒ…å ±ã‚­ãƒ£ãƒƒã‚·ãƒ¥)          (é€šçŸ¥ç”Ÿæˆã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹é›†è¨ˆ)
```

### ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚­ãƒ¼ãƒä¾‹

```typescript
// customer.created
{
  "eventId": "uuid",
  "eventType": "customer.created",
  "timestamp": "2024-10-08T10:00:00Z",
  "data": {
    "customerId": "cuid",
    "name": "å±±ç”°å¤ªéƒ",
    "email": "yamada@example.com",
    "assignedSalesId": "user_id"
  }
}

// task.due_soon
{
  "eventId": "uuid",
  "eventType": "task.due_soon",
  "timestamp": "2024-10-08T10:00:00Z",
  "data": {
    "taskId": "cuid",
    "title": "é¡§å®¢é¢è«‡",
    "dueDate": "2024-10-09T10:00:00Z",
    "userId": "user_id",
    "customerId": "customer_id"
  }
}
```

---

## ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

### Module Federation ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

**Host Shell (Shell App):**
- Next.js 14 (App Router)
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†
- å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- èªè¨¼çŠ¶æ…‹ç®¡ç†

**Remotes (Micro Frontends):**
1. **Customer MFE**: é¡§å®¢ç®¡ç†ç”»é¢
2. **Sales MFE**: å–¶æ¥­æ´»å‹•ç®¡ç†ç”»é¢
3. **Opportunity MFE**: å•†è«‡ãƒ»æ‰¿èªç®¡ç†ç”»é¢
4. **Analytics MFE**: ãƒ¬ãƒãƒ¼ãƒˆãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### Module Federation è¨­å®š

```javascript
// next.config.js (Host)
const NextFederationPlugin = require('@module-federation/nextjs-mf');

module.exports = {
  webpack: (config, options) => {
    config.plugins.push(
      new NextFederationPlugin({
        name: 'host',
        remotes: {
          customer: 'customer@http://localhost:3001/remoteEntry.js',
          sales: 'sales@http://localhost:3002/remoteEntry.js',
          opportunity: 'opportunity@http://localhost:3003/remoteEntry.js',
          analytics: 'analytics@http://localhost:3004/remoteEntry.js',
        },
        shared: {
          react: { singleton: true },
          'react-dom': { singleton: true },
        },
      })
    );
    return config;
  },
};
```

### å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª

```
packages/
  ui-components/        # shadcn/ui ãƒ™ãƒ¼ã‚¹ã®å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  theme/                # ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³
  utils/                # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  types/                # å‹å®šç¾©
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆå®Œäº†
2. ğŸ”„ å„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…
3. ğŸ”„ Kubernetes ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆä½œæˆ
4. ğŸ”„ ãƒã‚¤ã‚¯ãƒ­ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ
5. ğŸ”„ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰
6. ğŸ”„ ç›£è¦–ãƒ»ãƒ­ã‚°åŸºç›¤æ§‹ç¯‰
